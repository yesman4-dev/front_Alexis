<div class="container">
  <h2 class="titulo">Inventario General por Bodega</h2>

  <div *ngIf="bodegas.length === 0" class="mensaje-vacio">
    No hay inventario disponible.
  </div>

  <div *ngFor="let bodega of bodegas" class="bodega-card">
    <button class="accordion" (click)="toggleBodega(bodega.bodegaId)">
      <h3 class="nombre-bodega">{{ bodega.nombreBodega | uppercase }}</h3>
    </button>

    <div *ngIf="bodega.isOpen" class="contenido-bodega">

      <!-- ðŸ”¥ðŸ”¥ Totales por bodega (oculto a Rol 2) -->
      <div class="total-bodega arriba" *ngIf="idRol !== 2">
        <p>
          Valor total (unidad dominante):
          <strong>L. {{ bodega.valorTotalBodegaDominante | number:'1.2-2' }}</strong>
        </p>
      </div>

      <!-- Buscador -->
      <div class="buscador-productos">
        <input
          type="text"
          [(ngModel)]="bodega.filtro"
          placeholder="ðŸ” Buscar producto..."
          class="input-buscador"
        />
      </div>

      <!-- AcciÃ³n PDF (oculta para Rol 2) -->
      <div class="acciones-bodega" *ngIf="idRol !== 2">
        <button class="btn-generar-pdf" (click)="generarPDFPorBodega(bodega)">
          ðŸ“„ Generar PDF de esta bodega
        </button>
      </div>

      <div *ngIf="filtrarProductos(bodega).length === 0" class="mensaje-vacio">
        No hay productos que coincidan con el filtro.
      </div>

      <!-- Productos -->
      <div *ngFor="let producto of filtrarProductos(bodega)" class="producto-card">

        <!-- INFO PRODUCTO -->
        <div class="producto-header">
          <div>
            <h4 class="nombre-producto">{{ producto.nombreProducto }}</h4>
            <p class="unidad-base">Laboratorio: <strong>{{ producto.laboratorioNombre }}</strong></p>

            <p>
              Unidad dominante:
              <strong>{{ producto.unidadDominante.unidadMedida }}</strong>
            </p>

            <p>
              Stock dominante:
              <strong>{{ producto.stockEnUnidadDominante }}</strong>
            </p>

            <p>
              Stock total (unidades mÃ­nimas):
              <strong>{{ producto.stockMinimoTotal }}</strong>
            </p>

            <!-- ðŸ”¥ Valor inventario oculto a Rol 2 -->
            <p *ngIf="idRol !== 2">
              Valor total inventario:
              <strong>L. {{ producto.valorInventario | number:'1.2-2' }}</strong>
            </p>
          </div>
        </div>

        <!-- Presentaciones -->
        <div class="presentaciones">
          <table class="tabla-presentaciones">
            <thead>
              <tr>
                <th>PresentaciÃ³n</th>
                <th>Stock</th>
                <th>AcciÃ³n</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let presentacion of producto.presentaciones">
                <td>{{ presentacion.unidadMedida }}</td>
                <td>{{ presentacion.stock }}</td>
                <td>
                  <button
                    class="btn-rebajar"
                    *ngIf="idRol !== 2"
                    (click)="abrirModalRebajarStock(producto, bodega, presentacion)">
                    Rebajar en {{ presentacion.unidadMedida }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="accion-mover" *ngIf="idRol !== 2">
          <button class="btn-mover" (click)="modalMovimientoBodega(producto, bodega)">
            Mover producto
          </button>
        </div>

      </div>

    </div>
  </div>
</div>
