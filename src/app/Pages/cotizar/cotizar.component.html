<div class="cotizar-container">

  <mat-card class="mb-4 shadow-lg">
    <mat-card-title class="title">Buscar historial de precios</mat-card-title>
    <mat-card-content>
      <div class="form-layout">

        <!-- Cliente -->
        <mat-form-field appearance="outline">
          <mat-label>Seleccionar cliente</mat-label>
          <input type="text" matInput [formControl]="clienteControl" [matAutocomplete]="autoCliente">
          <mat-autocomplete #autoCliente="matAutocomplete" (optionSelected)="onClienteSeleccionado($event)">
            <mat-option *ngFor="let cliente of clientesFiltrados$ | async" [value]="cliente.nombreCliente">
              {{ cliente.nombreCliente }} - {{ cliente.telefono }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <!-- Producto -->
        <mat-form-field appearance="outline">
          <mat-label>Seleccionar producto</mat-label>
          <input type="text" matInput [formControl]="productoControl" [matAutocomplete]="autoProducto">
          <mat-autocomplete #autoProducto="matAutocomplete" (optionSelected)="onProductoSeleccionado($event)">
            <mat-option *ngFor="let producto of productosFiltrados$ | async" [value]="producto.nombreProducto">
              {{ producto.nombreProducto }} - {{ producto.laboratorioNombre }} - {{ producto.presentacionContenidoNombre }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <div class="action-button">
          <button mat-raised-button color="primary" (click)="buscarHistorial()">Ver historial</button>
        </div>

      </div>
    </mat-card-content>
  </mat-card>

  <!-- Tabla de resultados -->
  <mat-card *ngIf="historial.length > 0" class="tabla-card shadow-lg">
    <mat-card-title class="title">Historial de precios</mat-card-title>
    <div class="table-wrapper">
      <table mat-table [dataSource]="historial" class="mat-elevation-z2 full-width-table">

        <ng-container matColumnDef="ventaId">
          <th mat-header-cell *matHeaderCellDef>Factura</th>
          <td mat-cell *matCellDef="let h">{{ h.ventaId }}</td>
        </ng-container>

        <ng-container matColumnDef="fechaVenta">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let h">{{ h.fechaVenta | date: 'shortDate' }}</td>
        </ng-container>

        <ng-container matColumnDef="nombreProducto">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let h">{{ h.nombreProducto }}</td>
        </ng-container>

        <ng-container matColumnDef="unidadMedida">
          <th mat-header-cell *matHeaderCellDef>Unidad</th>
          <td mat-cell *matCellDef="let h">{{ h.unidadMedida }}</td>
        </ng-container>

        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let h">{{ h.cantidad }}</td>
        </ng-container>

        <ng-container matColumnDef="precioUnitario">
          <th mat-header-cell *matHeaderCellDef>Precio Unitario</th>
          <td mat-cell *matCellDef="let h">{{ h.precioUnitario | currency:'HNL' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </div>
  </mat-card>
</div>
