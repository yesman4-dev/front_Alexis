<div class="contenedor">
  <!-- Formulario para registrar un egreso -->
  <mat-card class="card-form">
    <mat-card-title>Registrar Egreso</mat-card-title>
    <form [formGroup]="EgresoForm" (ngSubmit)="crearEgreso()" class="formulario">
      <mat-form-field appearance="outline">
        <mat-label>Descripción</mat-label>
        <input matInput formControlName="descripcion" placeholder="Ej. Pago de servicios" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Valor</mat-label>
        <input matInput type="number" formControlName="valorIngreso" placeholder="Ej. 1500" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Tipo de egreso</mat-label>
        <mat-select formControlName="tipoEgresoId">
          <mat-option *ngFor="let tipo of tipoEgresosLista" [value]="tipo.id">
            {{ tipo.descripcion }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit" [disabled]="EgresoForm.invalid">Registrar</button>
    </form>
  </mat-card>

  <!-- Filtros de búsqueda -->
  <mat-card class="card-filtro">
    <mat-card-title>Filtrar Egresos</mat-card-title>
    <form [formGroup]="filtroForm" (ngSubmit)="filtrarEgresos()" class="formulario">

      <mat-form-field appearance="outline">
        <mat-label>Fecha inicio</mat-label>
        <input matInput [matDatepicker]="pickerInicio" formControlName="fechaInicio">
        <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
        <mat-datepicker #pickerInicio></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Fecha final</mat-label>
        <input matInput [matDatepicker]="pickerFinal" formControlName="fechaFinal">
        <mat-datepicker-toggle matSuffix [for]="pickerFinal"></mat-datepicker-toggle>
        <mat-datepicker #pickerFinal></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Tipo de egreso</mat-label>
        <mat-select formControlName="tipoEgresoId">
          <mat-option [value]="''">Todos</mat-option>
          <mat-option *ngFor="let tipo of tipoEgresosLista" [value]="tipo.id">
            {{ tipo.descripcion }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="accent" type="submit" [disabled]="filtroForm.invalid">Buscar</button>
      
      <button mat-raised-button color="primary" (click)="generarPdf()">
        <mat-icon>picture_as_pdf</mat-icon> Exportar PDF
      </button>
    </form>
  </mat-card>

  <!-- Tabla de egresos -->
  <mat-card class="card-tabla">
    <mat-card-title>Lista de Egresos</mat-card-title>
    <div class="tabla-container">

      <table mat-table [dataSource]="filteredDataSource" class="mat-elevation-z8 tabla">
        <!-- Columnas -->
        <ng-container matColumnDef="descripcion">
          <th mat-header-cell *matHeaderCellDef>Descripción</th>
          <td mat-cell *matCellDef="let egreso">{{ egreso.descripcion }}</td>
        </ng-container>

        <ng-container matColumnDef="valorIngreso">
          <th mat-header-cell *matHeaderCellDef>Valor</th>
          <td mat-cell *matCellDef="let egreso">L. {{ egreso.valorIngreso | number:'1.2-2' }}</td>
        </ng-container>

        <ng-container matColumnDef="egresoNombre">
          <th mat-header-cell *matHeaderCellDef>Tipo</th>
          <td mat-cell *matCellDef="let egreso">{{ egreso.egresoNombre }}</td>
        </ng-container>

        <ng-container matColumnDef="fechaRegistro">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let egreso">{{ egreso.fechaRegistro | date:'shortDate' }}</td>
        </ng-container>

        <!-- Encabezados y filas -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
    </div>
  </mat-card>

</div>
